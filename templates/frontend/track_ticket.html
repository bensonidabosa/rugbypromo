{% extends './base.html' %}
{% load static %}

{% block title %}Enter Lottery | Rugby Lottery{% endblock %}

{% block content %}

<!-- ================= BREADCRUMB ================= -->

<section class="breadcrumb-section fade-in">
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb custom-breadcrumb">
                <li class="breadcrumb-item">
                    <a href="{% url 'frontend:home' %}">Home</a>
                </li>
                <li class="breadcrumb-item active" aria-current="page">
                    üèâ Track Ticket
                </li>
            </ol>
        </nav>
    </div>
</section>

<!-- Track Section -->
<section class="track-section d-flex align-items-center">
    <div class="container text-center">

        <div class="row justify-content-center align-items-center">
            <div class="col-md-7 mb-5">
                <div class="track-box">
                    <h1 class="track-title">üéü Track Your Ticket</h1>
                    {% if error %}
                        <p class="text-danger">{{error}}</p>
                    {% endif %}

                    <form id="trackForm" method="post">
                        {% csrf_token %}

                        <input type="text" id="trackInput" name="tracking_code" class="form-control track-input"
                            placeholder="Enter your tracking code (e.g. RL-ABCD1234)" required>

                        <button type="submit" class="btn submit-btn mt-3">
                            CHECK RESULT
                        </button>
                    </form>

                    <!-- RESULT BOX (Backend will control content) -->
                    {% if ticket %}
                    <div class="result-container mt-5">

                        {% if ticket.status == "WON" %}
                        <!-- WINNER -->
                        <div class="ticket-result result-winner">

                            <div class="result-header">
                                <h3 class="result-title">üéâ Congratulations!</h3>
                                <span class="result-badge">WINNER</span>
                            </div>

                            <div class="result-body">
                                <p><strong>Tracking Code:</strong> {{ ticket.tracking_code }}</p>
                                <p><strong>Draw Date:</strong> {{ ticket.draw.draw_date|date:"F d, Y" }}</p>
                                <p><strong>Prize:</strong> ${{ ticket.prize_amount|floatformat:2 }}</p>
                            </div>

                            <div class="result-footer">
                                üì© A confirmation email has been sent with your payout details.
                            </div>

                        </div>

                        {% elif ticket.status == "PENDING" %}
                        <!-- PENDING -->
                        <div class="ticket-result result-pending">

                            <div class="result-header">
                                <h3 class="result-title">‚è≥ Lottery In Progress</h3>
                                <span class="result-badge">PENDING</span>
                            </div>

                            <div class="result-body">
                                <p><strong>Tracking Code:</strong> {{ ticket.tracking_code }}</p>
                                <p><strong>Draw Date:</strong> {{ ticket.draw.draw_date|date:"F d, Y" }}</p>
                                <p><strong>Status:</strong> Awaiting official draw results.</p>
                            </div>

                            <div class="result-footer">
                                üì¢ Results will be announced after the live draw.
                                Please check back later.
                            </div>

                        </div>

                        {% elif ticket.status == "LOST" %}
                        <!-- LOST -->
                        <div class="ticket-result result-lost">

                            <div class="result-header">
                                <h3 class="result-title">üò¢ Not This Time</h3>
                                <span class="result-badge">NOT A WINNER</span>
                            </div>

                            <div class="result-body">
                                <p><strong>Tracking Code:</strong> {{ ticket.tracking_code }}</p>
                                <p><strong>Draw Date:</strong> {{ ticket.draw.draw_date|date:"F d, Y" }}</p>
                                <p><strong>Result:</strong> This ticket did not win in this round.</p>
                            </div>

                            <div class="result-footer">
                                üéü Don't give up! Enter the next draw for another chance to win.
                            </div>

                        </div>
                        {% endif %}
                    </div>
                    {% endif %}

                </div>
            </div>
        </div>

    </div>
</section>


<script>
    document.addEventListener("DOMContentLoaded", () => {
        const trackForm = document.getElementById("trackForm");
        const trackBtn = trackForm ? trackForm.querySelector("button[type='submit']") : null;

        if (trackForm && trackBtn) {
            trackForm.addEventListener("submit", function (e) {
                e.preventDefault(); // stop default

                // If input is empty, let browser handle validation
                if (!trackForm.checkValidity()) {
                    trackForm.reportValidity();
                    return;
                }

                // Disable button to prevent multiple clicks
                trackBtn.disabled = true;

                // Show spinner
                trackBtn.innerHTML = `
                <span class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
                CHECKING...
            `;

                // Submit form after small delay (optional smooth effect)
                trackForm.submit();
            });
        }
    });
</script>

{% endblock %}